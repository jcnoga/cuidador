
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conex√£o Cuidado - Cuidadores e Assistidos</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #27ae60;
            --accent: #e67e22;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --danger: #e74c3c;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        body { background-color: #f4f7f6; color: #333; line-height: 1.6; }

        /* Layout & Nav */
        header { background: var(--primary); color: white; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        header h1 { font-size: 1.5rem; }
        nav button { background: none; border: none; color: white; cursor: pointer; margin-left: 15px; font-size: 1rem; }
        nav button:hover { text-decoration: underline; }

        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        
        /* Sections logic */
        .view-section { display: none; animation: fadeIn 0.5s; }
        .view-section.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Cards & Forms */
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-primary { background: var(--secondary); color: white; }
        .btn-primary:hover { background: #219150; }
        .btn-outline { border: 2px solid var(--secondary); color: var(--secondary); background: transparent; }
        .btn-danger { background: var(--danger); color: white; }
        
        input, select, textarea { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 4px; }
        
        .checkbox-group { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; margin: 10px 0; }
        .checkbox-item { display: flex; align-items: center; gap: 5px; }
        .checkbox-item input { width: auto; margin: 0; }

        /* Grid de Perfis */
        .profiles-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .profile-card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .profile-header { background: var(--secondary); color: white; padding: 15px; text-align: center; }
        .profile-body { padding: 15px; flex-grow: 1; }
        .profile-footer { padding: 15px; border-top: 1px solid #eee; text-align: center; }
        
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; margin-top: 5px; }
        .status-available { background: #d4edda; color: #155724; }
        .status-busy { background: #f8d7da; color: #721c24; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: white; margin: 10% auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; }
        .close { float: right; font-size: 28px; font-weight: bold; cursor: pointer; }

        /* Chat Simulado */
        .chat-box { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; margin-bottom: 10px; background: #f9f9f9; }
        .msg { margin-bottom: 8px; padding: 8px; border-radius: 5px; max-width: 80%; }
        .msg-me { background: #dcf8c6; margin-left: auto; }
        .msg-other { background: #fff; border: 1px solid #ddd; }

        /* Home Hero */
        .hero { text-align: center; padding: 50px 20px; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border-radius: 0 0 20px 20px; }
        .hero h2 { font-size: 2.5rem; margin-bottom: 20px; }
        .hero-buttons { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .hero-btn { padding: 15px 30px; font-size: 1.2rem; border-radius: 30px; text-decoration: none; cursor: pointer; border: none; font-weight: bold; }
        .hero-btn.assistido { background: white; color: var(--primary); }
        .hero-btn.cuidador { background: var(--accent); color: white; }

        /* Admin Panel */
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .admin-table th, .admin-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .admin-table th { background-color: var(--primary); color: white; }
    </style>
</head>
<body>

    <!-- Header / Navega√ß√£o -->
    <header>
        <div style="display:flex; align-items:center; gap:10px;">
            <i class="fas fa-hands-helping fa-2x"></i>
            <h1>Conex√£o Cuidado</h1>
        </div>
        <nav id="nav-links">
            <!-- Links injetados via JS -->
        </nav>
    </header>

    <!-- TELA 1: HOME (Landing Page) -->
    <section id="home-section" class="view-section active">
        <div class="hero">
            <h2>Encontre o cuidado ideal ou ofere√ßa seus servi√ßos</h2>
            <p>Conectando fam√≠lias e cuidadores com seguran√ßa e efici√™ncia.</p>
            <br>
            <div class="hero-buttons" id="home-actions">
                <button onclick="showRegister('assistido')" class="hero-btn assistido">üíô Buscar Cuidador (Fam√≠lia)</button>
                <button onclick="showRegister('cuidador')" class="hero-btn cuidador">üë©‚Äç‚öïÔ∏è Sou Cuidador (Trabalhar)</button>
            </div>
        </div>
        <div class="container">
            <div style="text-align:center; margin-top: 40px;">
                <h3>J√° tem cadastro?</h3>
                <button class="btn btn-outline" onclick="showLogin()">Fazer Login</button>
            </div>
        </div>
    </section>

    <!-- TELA 2: LOGIN -->
    <section id="login-section" class="view-section">
        <div class="container" style="max-width: 400px;">
            <div class="card">
                <h2>Login</h2>
                <input type="email" id="login-email" placeholder="Seu E-mail">
                <input type="password" id="login-pass" placeholder="Senha">
                <button class="btn btn-primary" style="width:100%" onclick="handleLogin()">Entrar</button>
                <p style="margin-top:10px; text-align:center;">
                    <a href="#" onclick="app.router('home')">Voltar</a>
                </p>
                <div style="margin-top:20px; font-size:0.8rem; color:grey; border-top:1px solid #eee; padding-top:10px;">
                    <p><strong>Admin Demo:</strong> admin@admin.com / 1234</p>
                </div>
            </div>
        </div>
    </section>

    <!-- TELA 3: CADASTRO -->
    <section id="register-section" class="view-section">
        <div class="container">
            <div class="card">
                <h2 id="reg-title">Cadastro</h2>
                <p style="color: #666; margin-bottom: 20px;">Preencha os dados com aten√ß√£o.</p>
                
                <form id="reg-form" onsubmit="handleRegister(event)">
                    <input type="hidden" id="reg-type">
                    
                    <!-- Dados Comuns -->
                    <h3>Dados de Acesso</h3>
                    <input type="text" id="reg-name" placeholder="Nome Completo" required>
                    <input type="email" id="reg-email" placeholder="E-mail" required>
                    <input type="password" id="reg-pass" placeholder="Senha" required>
                    <input type="tel" id="reg-phone" placeholder="Telefone / WhatsApp" required>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="reg-city" placeholder="Cidade" required>
                        <input type="text" id="reg-district" placeholder="Bairro" required>
                    </div>
                    <input type="text" id="reg-photo" placeholder="URL da Foto (Opcional)">

                    <!-- Campos Espec√≠ficos: ASSISTIDO -->
                    <div id="fields-assistido" style="display:none; margin-top:20px;">
                        <h3>Sobre o Assistido</h3>
                        <input type="number" id="reg-age-a" placeholder="Idade do Assistido">
                        <label>Condi√ß√£o Principal:</label>
                        <select id="reg-condition">
                            <option value="Idoso">Idoso (Sem defici√™ncia grave)</option>
                            <option value="PcD F√≠sica">PcD F√≠sica</option>
                            <option value="PcD Intelectual">PcD Intelectual</option>
                            <option value="Alzheimer">Alzheimer / Dem√™ncia</option>
                            <option value="Acamado">Acamado</option>
                            <option value="Outro">Outro</option>
                        </select>

                        <h4>Necessidades Especiais</h4>
                        <div class="checkbox-group" id="needs-checkboxes">
                            <!-- JS ir√° preencher -->
                        </div>

                        <h4>Hor√°rios Necess√°rios</h4>
                        <select id="reg-schedule-a">
                            <option value="Integral">Integral (8h-18h)</option>
                            <option value="Meio Per√≠odo">Meio Per√≠odo</option>
                            <option value="Plant√£o 12x36">Plant√£o 12x36</option>
                            <option value="Finais de Semana">Finais de Semana</option>
                            <option value="Interno (Dorme)">Interno (Dorme no local)</option>
                        </select>
                    </div>

                    <!-- Campos Espec√≠ficos: CUIDADOR -->
                    <div id="fields-cuidador" style="display:none; margin-top:20px;">
                        <h3>Perfil Profissional</h3>
                        <input type="number" id="reg-age-c" placeholder="Sua Idade">
                        <label>Forma√ß√£o:</label>
                        <select id="reg-formation">
                            <option value="Cuidador (Curso Livre)">Cuidador (Curso Livre)</option>
                            <option value="T√©cnico de Enfermagem">T√©cnico de Enfermagem</option>
                            <option value="Enfermeiro">Enfermeiro(a)</option>
                            <option value="Experi√™ncia Familiar">Experi√™ncia Familiar (Sem curso)</option>
                        </select>
                        
                        <input type="number" id="reg-exp" placeholder="Anos de Experi√™ncia">
                        <input type="text" id="reg-price" placeholder="Valor base (ex: R$ 150/dia)">

                        <h4>Prefer√™ncias de Atendimento</h4>
                        <div class="checkbox-group" id="prefs-checkboxes">
                            <!-- JS preenche -->
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" style="margin-top:20px; width:100%">Cadastrar</button>
                    <button type="button" class="btn btn-outline" style="margin-top:10px; width:100%" onclick="app.router('home')">Cancelar</button>
                </form>
            </div>
        </div>
    </section>

    <!-- TELA 4: DASHBOARD (Busca e Listagem) -->
    <section id="dashboard-section" class="view-section">
        <div class="container">
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap;">
                    <h2 id="dash-title">Painel</h2>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="search-input" placeholder="Buscar por nome, cidade..." onkeyup="renderList()" style="width:250px; margin:0;">
                        <button class="btn btn-primary" onclick="toggleMyProfile()">Meu Perfil</button>
                    </div>
                </div>
            </div>

            <!-- Modal Meu Perfil (Edi√ß√£o r√°pida) -->
            <div id="my-profile-area" class="card" style="display:none; border: 2px solid var(--secondary);">
                <h3>Meu Perfil e Status</h3>
                <p>Mantenha seus dados atualizados para aparecer nas buscas.</p>
                <div style="margin: 10px 0;">
                    <label><strong>Disponibilidade:</strong></label>
                    <select id="my-status" onchange="updateMyStatus()">
                        <option value="true">Dispon√≠vel / Buscando</option>
                        <option value="false">Indispon√≠vel / J√° Contratado</option>
                    </select>
                </div>
                <button class="btn btn-danger" onclick="deleteAccount()">Excluir Conta</button>
            </div>

            <h3 id="list-title" style="margin: 20px 0;">Resultados</h3>
            <div id="results-grid" class="profiles-grid">
                <!-- JS Renderiza Cards Aqui -->
            </div>
        </div>
    </section>

    <!-- TELA 5: ADMIN PANEL -->
    <section id="admin-section" class="view-section">
        <div class="container">
            <h2>Painel Administrativo</h2>
            <div class="card">
                <p>Vis√£o total de todos os usu√°rios cadastrados.</p>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Tipo</th>
                            <th>Email</th>
                            <th>Cidade</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="admin-tbody">
                        <!-- JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- MODAL DE DETALHES -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('detail-modal')">&times;</span>
            <div id="modal-body-content">
                <!-- Detalhes injetados -->
            </div>
        </div>
    </div>

    <!-- MODAL DE CHAT -->
    <div id="chat-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('chat-modal')">&times;</span>
            <h3>Chat com <span id="chat-target-name">...</span></h3>
            <div class="chat-box" id="chat-history">
                <!-- Mensagens -->
            </div>
            <div style="display:flex; gap:10px;">
                <input type="text" id="chat-input" placeholder="Digite sua mensagem...">
                <button class="btn btn-primary" onclick="sendMessage()">Enviar</button>
            </div>
        </div>
    </div>

    <script>
        /* --- 1. DATA & STATE --- */
        const needsOptions = [
            "Banho", "Alimenta√ß√£o", "Medicamentos", "Troca de Faldas", 
            "Cadeirante (Transfere)", "Companhia", "Limpeza leve", "Cozinhar"
        ];

        // Inicializa Banco de Dados Fake se n√£o existir
        if (!localStorage.getItem('conn_users')) {
            const initialData = [
                { id: 1, type: 'admin', name: 'Administrador', email: 'admin@admin.com', pass: '1234', city: 'Bras√≠lia', active: true },
                { id: 2, type: 'assistido', name: 'Sra. Maria Silva', email: 'maria@email.com', pass: '1234', city: 'S√£o Paulo', district: 'Moema', phone: '1199999999', age: 78, condition: 'Alzheimer', needs: ['Banho', 'Medicamentos'], schedule: 'Integral', active: true, photo: 'https://randomuser.me/api/portraits/women/66.jpg' },
                { id: 3, type: 'cuidador', name: 'Enf. Jo√£o Souza', email: 'joao@email.com', pass: '1234', city: 'S√£o Paulo', district: 'Centro', phone: '1198888888', age: 32, formation: 'T√©cnico de Enfermagem', exp: 5, price: '200/dia', prefs: ['Banho', 'Medicamentos', 'Cadeirante (Transfere)'], active: true, photo: 'https://randomuser.me/api/portraits/men/32.jpg' },
                { id: 4, type: 'cuidador', name: 'Ana Clara', email: 'ana@email.com', pass: '1234', city: 'Rio de Janeiro', district: 'Copacabana', phone: '2199999999', age: 28, formation: 'Cuidador (Curso Livre)', exp: 2, price: '150/dia', prefs: ['Companhia', 'Limpeza leve'], active: true, photo: 'https://randomuser.me/api/portraits/women/44.jpg' }
            ];
            localStorage.setItem('conn_users', JSON.stringify(initialData));
        }

        // Estado da Aplica√ß√£o
        const app = {
            user: null, // Usu√°rio logado
            usersData: JSON.parse(localStorage.getItem('conn_users')),
            
            save: function() {
                localStorage.setItem('conn_users', JSON.stringify(this.usersData));
            },

            // Roteamento Simples
            router: function(screenName) {
                document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
                
                // L√≥gica de acesso
                if (screenName === 'dashboard') {
                    if (!this.user) return this.router('login');
                    this.renderDashboard();
                } else if (screenName === 'admin') {
                    if (!this.user || this.user.type !== 'admin') return this.router('login');
                    this.renderAdmin();
                } else if (screenName === 'home') {
                    this.user = null; // Logout ao ir pra home
                    this.updateNav();
                }

                const target = document.getElementById(screenName + '-section');
                if(target) target.classList.add('active');
                this.updateNav();
            },

            updateNav: function() {
                const nav = document.getElementById('nav-links');
                if (this.user) {
                    let html = `<span>Ol√°, ${this.user.name}</span>`;
                    if(this.user.type === 'admin') html += `<button onclick="app.router('admin')">Admin</button>`;
                    else html += `<button onclick="app.router('dashboard')">Painel</button>`;
                    
                    html += `<button onclick="app.router('home')">Sair</button>`;
                    nav.innerHTML = html;
                } else {
                    nav.innerHTML = `<button onclick="showLogin()">Entrar</button>`;
                }
            }
        };

        /* --- 2. AUTHENTICATION --- */
        function showLogin() { app.router('login'); }
        
        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            
            const user = app.usersData.find(u => u.email === email && u.pass === pass);
            
            if (user) {
                app.user = user;
                if (user.type === 'admin') app.router('admin');
                else app.router('dashboard');
            } else {
                alert("E-mail ou senha inv√°lidos!");
            }
        }

        function showRegister(type) {
            app.router('register');
            document.getElementById('reg-type').value = type;
            document.getElementById('reg-title').innerText = type === 'assistido' ? "Cadastro de Assistido (Fam√≠lia)" : "Cadastro de Cuidador";
            
            // Toggle fields
            document.getElementById('fields-assistido').style.display = type === 'assistido' ? 'block' : 'none';
            document.getElementById('fields-cuidador').style.display = type === 'cuidador' ? 'block' : 'none';

            // Preencher checkboxes din√¢micos
            const container = type === 'assistido' ? document.getElementById('needs-checkboxes') : document.getElementById('prefs-checkboxes');
            container.innerHTML = needsOptions.map(opt => `
                <div class="checkbox-item">
                    <input type="checkbox" value="${opt}" name="specs"> ${opt}
                </div>
            `).join('');
        }

        function handleRegister(e) {
            e.preventDefault();
            const type = document.getElementById('reg-type').value;
            
            // Coleta checkboxes
            const specs = Array.from(document.querySelectorAll('input[name="specs"]:checked')).map(cb => cb.value);

            const newUser = {
                id: Date.now(),
                type: type,
                name: document.getElementById('reg-name').value,
                email: document.getElementById('reg-email').value,
                pass: document.getElementById('reg-pass').value,
                phone: document.getElementById('reg-phone').value,
                city: document.getElementById('reg-city').value,
                district: document.getElementById('reg-district').value,
                photo: document.getElementById('reg-photo').value || 'https://via.placeholder.com/150',
                active: true
            };

            if (type === 'assistido') {
                newUser.age = document.getElementById('reg-age-a').value;
                newUser.condition = document.getElementById('reg-condition').value;
                newUser.schedule = document.getElementById('reg-schedule-a').value;
                newUser.needs = specs;
            } else {
                newUser.age = document.getElementById('reg-age-c').value;
                newUser.formation = document.getElementById('reg-formation').value;
                newUser.exp = document.getElementById('reg-exp').value;
                newUser.price = document.getElementById('reg-price').value;
                newUser.prefs = specs;
            }

            app.usersData.push(newUser);
            app.save();
            alert("Cadastro realizado com sucesso! Fa√ßa login.");
            app.router('login');
        }

        /* --- 3. DASHBOARD & PRIVACY LOGIC --- */
        app.renderDashboard = function() {
            const title = document.getElementById('dash-title');
            const listTitle = document.getElementById('list-title');
            
            if (app.user.type === 'assistido') {
                title.innerText = "Fam√≠lia: Buscar Profissionais";
                listTitle.innerText = "Cuidadores Dispon√≠veis";
            } else {
                title.innerText = "Profissional: Oportunidades";
                listTitle.innerText = "Assistidos buscando ajuda";
            }
            
            // Setup My Profile Edit
            const statusSelect = document.getElementById('my-status');
            statusSelect.value = app.user.active.toString();

            renderList();
        };

        function renderList() {
            const grid = document.getElementById('results-grid');
            const search = document.getElementById('search-input').value.toLowerCase();
            grid.innerHTML = '';

            // L√ìGICA DE PRIVACIDADE PRINCIPAL
            // Quem v√™ quem?
            let targetType = '';
            if (app.user.type === 'assistido') targetType = 'cuidador'; // Assistido s√≥ v√™ cuidador
            else if (app.user.type === 'cuidador') targetType = 'assistido'; // Cuidador s√≥ v√™ assistido

            const list = app.usersData.filter(u => 
                u.type === targetType && // Filtro de tipo
                u.active === true && // Filtro de disponibilidade
                (u.name.toLowerCase().includes(search) || u.city.toLowerCase().includes(search)) // Filtro de busca
            );

            if (list.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">Nenhum resultado encontrado.</p>';
                return;
            }

            list.forEach(u => {
                // Monta os cards
                let detailsPreview = '';
                if (u.type === 'assistido') {
                    detailsPreview = `<p><strong>Condi√ß√£o:</strong> ${u.condition}</p><p><strong>Hor√°rio:</strong> ${u.schedule}</p>`;
                } else {
                    detailsPreview = `<p><strong>Forma√ß√£o:</strong> ${u.formation}</p><p><strong>Valor:</strong> ${u.price}</p>`;
                }

                const html = `
                    <div class="profile-card">
                        <div class="profile-header">
                            <h3>${u.name}</h3>
                            <small>${u.city} - ${u.district}</small>
                        </div>
                        <div class="profile-body">
                            <div style="text-align:center; margin-bottom:10px;">
                                <img src="${u.photo}" style="width:80px; height:80px; border-radius:50%; object-fit:cover;">
                            </div>
                            ${detailsPreview}
                            <p style="margin-top:5px; font-size:0.9rem; color:#666;">${u.type === 'assistido' ? 'Precisa de: ' + u.needs.join(', ') : 'Faz: ' + u.prefs.join(', ')}</p>
                        </div>
                        <div class="profile-footer">
                            <button class="btn btn-primary" onclick="showDetails(${u.id})">Ver Detalhes</button>
                        </div>
                    </div>
                `;
                grid.innerHTML += html;
            });
        }

        /* --- 4. DETAILS & CHAT --- */
        function showDetails(id) {
            const u = app.usersData.find(user => user.id === id);
            if(!u) return;

            const modal = document.getElementById('detail-modal');
            const content = document.getElementById('modal-body-content');
            
            let specificInfo = '';
            if(u.type === 'assistido') {
                specificInfo = `
                    <h3>Necessidades</h3>
                    <p><strong>Condi√ß√£o:</strong> ${u.condition}</p>
                    <p><strong>Idade:</strong> ${u.age} anos</p>
                    <p><strong>Hor√°rio:</strong> ${u.schedule}</p>
                    <p><strong>Precisa de ajuda com:</strong> <br> ${u.needs.map(n => `<span class="status-badge status-busy">${n}</span>`).join(' ')}</p>
                `;
            } else {
                specificInfo = `
                    <h3>Dados Profissionais</h3>
                    <p><strong>Forma√ß√£o:</strong> ${u.formation}</p>
                    <p><strong>Experi√™ncia:</strong> ${u.exp} anos</p>
                    <p><strong>Valor/Pretens√£o:</strong> ${u.price}</p>
                    <p><strong>Realiza:</strong> <br> ${u.prefs.map(n => `<span class="status-badge status-available">${n}</span>`).join(' ')}</p>
                `;
            }

            content.innerHTML = `
                <div style="display:flex; align-items:center; gap:20px; margin-bottom:20px;">
                    <img src="${u.photo}" style="width:100px; height:100px; border-radius:50%; object-fit:cover;">
                    <div>
                        <h2>${u.name}</h2>
                        <p><i class="fas fa-map-marker-alt"></i> ${u.city}, ${u.district}</p>
                    </div>
                </div>
                <hr style="margin-bottom:15px;">
                ${specificInfo}
                <div style="margin-top:30px; display:flex; gap:10px;">
                    <button class="btn btn-primary" onclick="openChat('${u.name}')">üí¨ Chat Interno</button>
                    <a href="https://wa.me/55${u.phone.replace(/\D/g,'')}" target="_blank" class="btn btn-secondary" style="background:#25D366; color:white; text-decoration:none; display:inline-block; padding:10px 20px; border-radius:5px; font-weight:bold;">WhatsApp</a>
                </div>
            `;

            modal.style.display = 'block';
        }

        function openChat(targetName) {
            document.getElementById('detail-modal').style.display = 'none';
            document.getElementById('chat-modal').style.display = 'block';
            document.getElementById('chat-target-name').innerText = targetName;
            document.getElementById('chat-history').innerHTML = '<p style="text-align:center; color:grey; font-size:0.8rem;">In√≠cio da conversa segura.</p>';
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const history = document.getElementById('chat-history');
            if(input.value.trim() === '') return;

            // Msg Enviada
            history.innerHTML += `<div class="msg msg-me">${input.value}</div>`;
            
            // Resposta Autom√°tica Simulada
            setTimeout(() => {
                history.innerHTML += `<div class="msg msg-other">Ol√°! Obrigado pelo contato. Podemos conversar melhor?</div>`;
                history.scrollTop = history.scrollHeight;
            }, 1000);

            input.value = '';
            history.scrollTop = history.scrollHeight;
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        /* --- 5. USER MANAGEMENT --- */
        function toggleMyProfile() {
            const area = document.getElementById('my-profile-area');
            area.style.display = area.style.display === 'none' ? 'block' : 'none';
        }

        function updateMyStatus() {
            const newVal = document.getElementById('my-status').value === 'true';
            app.user.active = newVal;
            
            // Atualiza no array principal
            const idx = app.usersData.findIndex(u => u.id === app.user.id);
            app.usersData[idx].active = newVal;
            app.save();
            alert("Status atualizado!");
        }

        function deleteAccount() {
            if(confirm("Tem certeza? Esta a√ß√£o n√£o pode ser desfeita.")) {
                const idx = app.usersData.findIndex(u => u.id === app.user.id);
                app.usersData.splice(idx, 1);
                app.save();
                alert("Conta exclu√≠da.");
                app.router('home');
            }
        }

        /* --- 6. ADMIN --- */
        app.renderAdmin = function() {
            const tbody = document.getElementById('admin-tbody');
            tbody.innerHTML = '';
            
            app.usersData.forEach(u => {
                if(u.type === 'admin') return;
                tbody.innerHTML += `
                    <tr>
                        <td>${u.name}</td>
                        <td>${u.type}</td>
                        <td>${u.email}</td>
                        <td>${u.city}</td>
                        <td>
                            <button onclick="adminDelete(${u.id})" style="color:red; border:none; background:none; cursor:pointer;">Excluir</button>
                        </td>
                    </tr>
                `;
            });
        };

        function adminDelete(id) {
            if(confirm("Admin: Excluir usu√°rio?")) {
                const idx = app.usersData.findIndex(u => u.id === id);
                app.usersData.splice(idx, 1);
                app.save();
                app.renderAdmin();
            }
        }

        // Close modals on outside click
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = "none";
            }
        }

        // Init
        app.updateNav();
    </script>
</body>
</html>